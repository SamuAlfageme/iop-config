---
  apiVersion: helm.fluxcd.io/v1
  kind: HelmRelease
  metadata:
    name: cern-iop-staging
    namespace: staging
    annotations:
      fluxcd.io/automated: "true"
  spec:
    releaseName: cern-iop-staging
    chart:
      # TODO(SamuAlfageme):
      # Replace with HelmRelease.sepc.{repository, name, version}
      git: https://github.com/sciencemesh/charts.git
      path: iop
      ref: init_flux
    values:
      revad:
        image:
          tag: latest
      ingress:
        enabled: true
        hostname: sciencemesh.cernbox.cern.ch
        annotations:
          kubernetes.io/ingress.class: nginx
          nginx.ingress.kubernetes.io/ssl-redirect: "true"
          nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
        tls:
          - secretName: cernbox-wildcard
            hosts:
              - sciencemesh.cernbox.cern.ch
